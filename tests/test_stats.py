import pytest

from rolling.stats import RollingMean, RollingVar

@pytest.mark.parametrize('array,window_size,expected', [
    ([3, 0, 1, 7, 2], 5, [13/5]),
    ([3, 0, 1, 7, 2], 4, [11/4, 10/4]),
    ([3, 0, 1, 7, 2], 3, [4/3, 8/3, 10/3]),
    ([3, 0, 1, 7, 2], 2, [3/2, 1/2, 8/2, 9/2]),
    ([3, 0, 1, 7, 2], 1, [3, 0, 1, 7, 2]),

    ([3, -8, 1, 7, -2], 5, [1/5]),
    ([3, -8, 1, 7, -2], 4, [3/4, -2/4]),
    ([3, -8, 1, 7, -2], 3, [-4/3, 0/3, 6/3]),
    ([3, -8, 1, 7, -2], 2, [-5/2, -7/2, 8/2, 5/2]),
    ([3, -8, 1, 7, -2], 1, [3, -8, 1, 7, -2]),
])
def test_rolling_mean(array, window_size, expected):
    r = RollingMean(array, window_size)
    assert pytest.approx(list(r)) == expected

@pytest.mark.parametrize('array', [
    [82, 80, 14, 73,  9, 19, 60, 31,  4, 87, 38, 36, 38, 58, 20,
     97, 25, 99, 79, 31, 97, 73, 79, 71, 78, 56, 73, 24, 53, 59]
])
@pytest.mark.parametrize('window_size,expected', [
    (5,
    [1354.3, 1190.5, 860.5, 739.8, 498.3, 1106.7, 977.5, 900.7, 881.8000000000001,
     476.8, 182, 878.1999999999999, 978.3, 1429.7, 1499, 1281.2, 1281.2,
     753.2, 601.2, 585.2, 105.80000000000001, 85.3, 85.3, 481.29999999999995,
     450.70000000000005, 321.5]),
    (10,
    [1129.8777777777777, 970.5, 787.6555555555556, 722.0555555555555, 632.8888888888889,
     574.1, 834.1, 854.7111111111111, 1129.7333333333333, 922.2333333333333,
     871.2111111111111, 1034.4444444444443, 990.4555555555555, 942.6222222222223,
     936.9888888888889, 666.3222222222223, 614.8444444444444, 378.0444444444445,
     517.2111111111111, 510.27777777777777, 386.4555555555556]),
    (20,
    [958, 1021.3552631578947, 1001.5157894736842, 970.5552631578947,
     966.4710526315789, 888.2105263157895, 812.5552631578947, 823.9473684210526,
     846.6605263157895, 687.4105263157895, 648.8]),
])
def test_rolling_var(array, window_size, expected):
    r = RollingVar(array, window_size)
    assert pytest.approx(list(r)) == expected


